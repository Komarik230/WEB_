(function(k){function n(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return a}function A(a){for(var b=[],d=a.length,p=a[0].length,f=0;f<d;f++)b=b.concat(a[f]);a=b.length;for(var g;a;)g=Math.floor(Math.random()*a--),f=b[a],b[a]=b[g],b[g]=f;a=[];for(g=f=0;g<d;g++){for(var c=[],e=0;e<p;e++)c.push(b[f]),f++;a.push(c)}return a}function e(a,b){this.el=a;this.inner=this.el.querySelector("div");this.allItems=[].slice.call(this.inner.children);if(this.allItemsCount=this.allItems.length)this.items=
[].slice.call(this.inner.querySelectorAll("div.portfolio-block:not([data-dummy])")),this.itemsCount=this.items.length,l=this.items.length-1,this.current=0,this.options=n({},this.options),n(this.options,b),this._init()}var l;Modernizr.addTest("csstransformspreserve3d",function(){var a=Modernizr.prefixed("transformStyle"),b;if(!a)return!1;a=a.replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()}).replace(/^ms-/,"-ms-");Modernizr.testStyles("#modernizr{"+a+":preserve-3d;}",function(d,p){b=k.getComputedStyle?
getComputedStyle(d,null).getPropertyValue(a):""});return"preserve-3d"===b});var q=Modernizr.csstransitions,m=Modernizr.csstransformspreserve3d,r={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[Modernizr.prefixed("transition")];e.prototype.options={};e.prototype._init=function(){this.currentItem=this.items[this.current];this._addNavigation();this._getSizes();this._initEvents()};e.prototype._addNavigation=
function(){this.wrapper=document.createElement("div");this.wrapper.className="lpbuilder-photostack-nav-wrapper";this.prevArrow=document.createElement("span");this.prevArrow.className="lpbuilder-photostack-prev";this.nextArrow=document.createElement("span");this.nextArrow.className="lpbuilder-photostack-next";this.nav=document.createElement("nav");for(var a="",b=0;b<this.itemsCount;++b)a+="<span></span>";this.nav.innerHTML=a;this.wrapper.appendChild(this.prevArrow);this.wrapper.appendChild(this.nav);this.wrapper.appendChild(this.nextArrow);
this.el.appendChild(this.wrapper);this.navDots=[].slice.call(this.nav.children);this.navperv=[].slice.call(this.prevArrow);this.navnext=[].slice.call(this.nextArrow)};e.prototype._initEvents=function(){var a=this,b=classie.hasClass(this.el,"photostack-start"),d=function(){var p=function(){q&&classie.addClass(a.el,"photostack-transition")};b?(this.removeEventListener("click",d),classie.removeClass(a.el,"photostack-start"),p()):(a.openDefault=!0,setTimeout(p,25));a.started=!0;a._showPhoto(a.current)};
b?(this._shuffle(),this.el.addEventListener("click",d)):d();jQuery(this.nextArrow).on("click",function(){var b=a.current;if(b===l)var b=0,d=function(){a._showPhoto(b)};else b+=1,d=function(){a._showPhoto(b)};d()});jQuery(this.prevArrow).on("click",function(){var b=a.current;event.preventDefault();if(0===b)var b=l,d=function(){a._showPhoto(b)};else--b,d=function(){a._showPhoto(b)};d()});this.navDots.forEach(function(b,d){b.addEventListener("click",function(){if(d===a.current)a._rotateItem();else{var b=
function(){a._showPhoto(d)};a.flipped?a._rotateItem(b):b()}})});k.addEventListener("resize",function(){a._resizeHandler()})};e.prototype._resizeHandler=function(){var a=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout);this._resizeTimeout=setTimeout(function(){a._resize();a._resizeTimeout=null},100)};e.prototype._resize=function(){var a=this,b=function(){a._shuffle(!0)};this._getSizes();this.started&&this.flipped?this._rotateItem(b):b()};e.prototype._showPhoto=function(a){if(this.isShuffling)return!1;
this.isShuffling=!0;classie.hasClass(this.currentItem,"photostack-flip")&&(this._removeItemPerspective(),classie.removeClass(this.navDots[this.current],"flippable"));classie.removeClass(this.navDots[this.current],"current");classie.removeClass(this.currentItem,"photostack-current");this.current=a;this.currentItem=this.items[this.current];classie.addClass(this.navDots[this.current],"current");this.currentItem.querySelector(".photostack-back")&&classie.addClass(this.navDots[a],"flippable");this._shuffle()};
e.prototype._shuffle=function(a){var b=a?1:this.currentItem.getAttribute("data-shuffle-iteration")||1;if(0>=b||!this.started||this.openDefault)b=1;this.openDefault&&(classie.addClass(this.currentItem,"photostack-flip"),this.isShuffling=this.openDefault=!1);var d=Math.ceil(this.sizes.inner.width/(.5*this.sizes.item.width)),e=Math.ceil(this.sizes.inner.height/(.5*this.sizes.item.height)),f=(d*this.sizes.item.width*.5+this.sizes.item.width/2-this.sizes.inner.width)/2,g=(e*this.sizes.item.height*.5+this.sizes.item.height/
2-this.sizes.inner.height)/2,c=this,z=function(){--b;for(var a=[],h=0;h<e;++h)for(var m=a[h]=[],t=0;t<d;++t){var k=.5*t*c.sizes.item.width-f,l=.5*h*c.sizes.item.height-g,w=0,x=0;if(c.started&&0===b){var y=c._isOverlapping({x:k,y:l});if(y.overlapping)switch(w=y.noOverlap.x,x=y.noOverlap.y,Math.floor(3*Math.random())){case 0:w=0;break;case 1:x=0}}m[t]={x:k+w,y:l+x}}var a=A(a),u=0,v=0,n=0;c.allItems.forEach(function(f,g){u===d-1?(v=v===e-1?0:v+1,u=1):++u;var h=a[v][u-1],k=h.x,h=h.y,l=function(){++n;
q&&this.removeEventListener(r,l);n===c.allItemsCount&&(0<b?z.call():(classie.addClass(c.currentItem,"photostack-flip"),c.isShuffling=!1,"function"===typeof c.options.callback&&c.options.callback(c.currentItem)))};c.items.indexOf(f)===c.current&&c.started&&0===b?(c.currentItem.style.WebkitTransform="translate("+c.centerItem.x+"px,"+c.centerItem.y+"px) rotate(0deg)",c.currentItem.style.msTransform="translate("+c.centerItem.x+"px,"+c.centerItem.y+"px) rotate(0deg)",c.currentItem.style.transform="translate("+
c.centerItem.x+"px,"+c.centerItem.y+"px) rotate(0deg)",c.currentItem.querySelector(".photostack-back")&&c._addItemPerspective(),classie.addClass(c.currentItem,"photostack-current")):(f.style.WebkitTransform="translate("+k+"px,"+h+"px) rotate("+Math.floor(71*Math.random()+-35)+"deg)",f.style.msTransform="translate("+k+"px,"+h+"px) rotate("+Math.floor(71*Math.random()+-35)+"deg)",f.style.transform="translate("+k+"px,"+h+"px) rotate("+Math.floor(71*Math.random()+-35)+"deg)");c.started&&(q?f.addEventListener(r,
l):l())})};z.call()};e.prototype._getSizes=function(){this.sizes={inner:{width:this.inner.offsetWidth,height:this.inner.offsetHeight},item:{width:this.currentItem.offsetWidth,height:this.currentItem.offsetHeight}};this.centerItem={x:this.sizes.inner.width/2-this.sizes.item.width/2,y:this.sizes.inner.height/2-this.sizes.item.height/2}};e.prototype._isOverlapping=function(a){var b=this.sizes.item.width+this.sizes.item.width/3,d=this.sizes.item.height+this.sizes.item.height/3,e=this.sizes.inner.width/
2-b/2,f=this.sizes.inner.height/2-d/2,g=this.sizes.item.width,c=this.sizes.item.height;if(!(a.x+g<e||a.x>e+b||a.y+c<f||a.y>f+d)){var k=.5>Math.random(),l=Math.floor(Math.random()*(g/4+1)),h=Math.floor(Math.random()*(c/4+1));return{overlapping:!0,noOverlap:{x:k?-1*(a.x-e+g)-l:e+b-(a.x+g)+g+l,y:k?-1*(a.y-f+c)-h:f+d-(a.y+c)+c+h}}}return{overlapping:!1}};e.prototype._addItemPerspective=function(){classie.addClass(this.el,"photostack-perspective")};e.prototype._removeItemPerspective=function(){classie.removeClass(this.el,
"photostack-perspective");classie.removeClass(this.currentItem,"photostack-flip")};e.prototype._rotateItem=function(a){if(classie.hasClass(this.el,"photostack-perspective")&&!this.isRotating&&!this.isShuffling){this.isRotating=!0;var b=this,d=function(){q&&m&&this.removeEventListener(r,d);b.isRotating=!1;"function"===typeof a&&a()};this.flipped?(classie.removeClass(this.navDots[this.current],"flip"),m?(this.currentItem.style.WebkitTransform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) rotateY(0deg)",
this.currentItem.style.transform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) rotateY(0deg)"):classie.removeClass(this.currentItem,"photostack-showback")):(classie.addClass(this.navDots[this.current],"flip"),m?(this.currentItem.style.WebkitTransform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) translate("+this.sizes.item.width+"px) rotateY(-179.9deg)",this.currentItem.style.transform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) translate("+this.sizes.item.width+
"px) rotateY(-179.9deg)"):classie.addClass(this.currentItem,"photostack-showback"));this.flipped=!this.flipped;q&&m?this.currentItem.addEventListener(r,d):d()}};k.Photostack=e})(window);